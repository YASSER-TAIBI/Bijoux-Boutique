<!-- Order History Container -->
<div class="order-history-container">
  <div class="container">
    <!-- En-tête -->
    <div class="order-history-header">
      <h1>Mes Commandes</h1>
    </div>

    <!-- État de chargement -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
      <p>Chargement de vos commandes...</p>
    </div>

    <!-- Message d'erreur -->
    <div class="error-message" *ngIf="error">
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="retry()">
        <i class="fas fa-sync-alt"></i> Réessayer
      </button>
    </div>

    <!-- Contenu principal -->
    <ng-container *ngIf="!loading && !error">
      <!-- Filtres et contrôles -->
      <div class="controls" *ngIf="orders.length > 0">
        <div class="search-box">
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            (input)="applyFilters()"
            placeholder="Rechercher une commande..."
          >
          <i class="fas fa-search"></i>
        </div>

        <div class="filters">
          <div class="sort-controls">
            <select [(ngModel)]="sortOption" (change)="applyFilters()">
              <option value="date">Date</option>
              <option value="price">Prix</option>
              <option value="status">Statut</option>
            </select>
            <button class="sort-direction" (click)="toggleSortDirection()">
              <i class="fas" [class.fa-sort-up]="sortDirection === 'asc'" [class.fa-sort-down]="sortDirection === 'desc'"></i>
            </button>
          </div>

          <select [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="all">Tous les statuts</option>
            <option value="en cours">En cours</option>
            <option value="expédiée">Expédiée</option>
            <option value="livrée">Livrée</option>
          </select>
        </div>
      </div>

      <!-- Message si aucune commande -->
    <div *ngIf="orders.length === 0" class="no-orders">
      <i class="fas fa-shopping-cart"></i>
      <h3>Vous n'avez pas encore passé de commande</h3>
      <p>Découvrez notre catalogue et passez votre première commande dès maintenant !</p>
      <button class="btn-primary" routerLink="/">Découvrir nos produits</button>
    </div>

      <!-- Liste des commandes -->
      <div class="orders-list" *ngIf="orders.length > 0">
        <div class="order-card" *ngFor="let order of filteredOrders | slice:(currentPage-1)*itemsPerPage:currentPage*itemsPerPage">
          <div class="order-header">
            <div class="order-info">
              <span class="label">Numéro de commande: </span>
              <span class="value">{{ order.orderNumber }}</span>
            </div>
            <div class="order-status" [ngClass]="getOrderStatusClass(order.status)">
              {{ order.status }}
              <i class="fas fa-check-circle" *ngIf="order.status.toLowerCase() === 'livrée'"></i>
            </div>
          </div>

          <!-- Liste des articles -->
          <div class="order-details" *ngFor="let item of order.items">
            <div class="product-info">
              <img [src]="'../../../assets/images/Products/' + item.productId + '.jpg'" [alt]="item.name" class="product-image">
              <div class="product-details">
                <h3>{{ item.name }}</h3>
              </div>
            </div>

            <div class="purchase-info">
              <div class="quantity">
                <span class="label">Quantité:</span>
                <span class="value">{{ item.quantity }}</span>
              </div>
              <div class="total-price">
                <span class="value">{{ item.price | currency:'EUR':'symbol':'1.2-2' }}</span>
              </div>
            </div>
          </div>

          <!-- Résumé de la commande -->
          <div class="order-summary">
            <div class="date">
              <span class="label">Date de commande:</span>
              <span class="value">{{ order.orderDate | date:'dd/MM/yy - HH:mm' }}</span>
            </div>
            <div class="delivery-date">
              <span class="label">Date de livraison estimée:</span>
              <span class="value">{{ order.deliveryDate | date:'dd/MM/yy' }}</span>
            </div>
            <div class="total">
              <span class="label">Total:</span>
              <span class="value">{{ order.totalPrice | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>
          </div>

          <div class="order-actions">
            <button class="view-details-btn" [routerLink]="['/order-details', order._id]">
              <i class="fas fa-eye"></i> Voir les détails
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button 
          [disabled]="currentPage === 1" 
          (click)="goToPage(currentPage - 1)"
          class="page-btn prev"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <span class="page-info">Page {{ currentPage }} sur {{ totalPages }}</span>
        
        <button 
          [disabled]="currentPage === totalPages" 
          (click)="goToPage(currentPage + 1)"
          class="page-btn next"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </ng-container>
  </div>
</div>